<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KARDS风格卡牌模板 - 可编辑</title>
<style>
:root {
  --accent: #9b8c5c; /* 阵营主色 */
  --paper: #efe7d5;
  --paper-2: #e5dcc6;
  --ink: #2b2b2b;
  --border-outer: #2f2a22;
  --border-inner: #d0c6ae;
  --muted: #6b665b;
  --good: #2b8a3e;
  --bad: #b43a3a;
}
* { box-sizing: border-box; }
body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, "PingFang SC", "Microsoft YaHei", sans-serif; background:#121212; color:#eee; }
.wrapper { display:flex; gap:24px; padding:24px; align-items:flex-start; flex-wrap:wrap;}
.preview { flex:0 0 auto;}
.card {
  width: 340px;
  aspect-ratio: 2 / 3;
  position: relative;
  background: radial-gradient(120% 100% at 50% 0%, var(--paper) 0%, var(--paper-2) 80%);
  border-radius: 16px;
  border: 3px solid var(--border-outer);
  box-shadow: 0 12px 30px rgba(0,0,0,.45), inset 0 0 0 3px var(--border-inner);
  overflow: hidden;
  color: var(--ink);
}
.card .inner { position:absolute; inset:10px; border-radius:10px; overflow:hidden; }
.card .cost {
  position:absolute; top:8px; left:8px;
  width:52px; height:52px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff 0, #eee 40%, #d2c8a6 70%, #a99b6c 100%);
  border:3px solid #3b382e; display:flex; align-items:center; justify-content:center;
  font-weight:800; font-size:22px; color:#1f1d18; text-shadow:0 1px 1px rgba(255,255,255,.6);
  box-shadow: 0 2px 4px rgba(0,0,0,.35);
}
.card .rarity {
  position:absolute; top:14px; right:12px; font-size:18px; letter-spacing:2px; color:#caa73c;
  text-shadow: 0 1px 0 #5c4b13, 0 0 6px rgba(202,167,60,.35);
}
.card .art {
  position:absolute; left:10px; right:10px; top:10px; height:58%;
  background: #bbb center/cover no-repeat;
  border-radius: 8px; overflow:hidden; box-shadow: inset 0 0 0 2px rgba(0,0,0,.35);
}
.card .art img { width:100%; height:100%; object-fit:cover; display:block; }
.name-banner {
  position:absolute; left:20px; right:20px; top:58%;
  transform: translateY(-50%);
  height:44px; display:flex; align-items:center; padding:0 12px 0 6px;
  background: linear-gradient(180deg, color-mix(in lab, var(--accent), #fff 25%), var(--accent));
  color: #fff; font-weight:800; letter-spacing:.5px; text-shadow: 0 1px 2px rgba(0,0,0,.6);
  border-radius:8px;
  box-shadow: 0 2px 4px rgba(0,0,0,.25), inset 0 0 0 2px rgba(255,255,255,.15);
}
.name-banner::before, .name-banner::after {
  content:""; position:absolute; top:100%; width:18px; height:14px; background: var(--accent); filter: brightness(.85);
}
.name-banner::before { left:0; clip-path: polygon(0 0, 100% 0, 0 100%); }
.name-banner::after  { right:0; clip-path: polygon(0 0, 100% 0, 100% 100%); }
.faction-flag {
  width:26px; height:26px; border-radius:50%; margin-right:8px; flex:0 0 auto;
  background: conic-gradient(from 0deg, #fff 0 25%, transparent 25% 50%, #d00 50% 75%, transparent 75% 100%);
  border:2px solid rgba(255,255,255,.5); box-shadow:0 0 0 2px rgba(0,0,0,.25) inset;
}
.card .name { font-size:18px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.card .type {
  position:absolute; top:calc(58% + 24px); left:18px; right:18px;
  font-size:13px; font-weight:700; color: var(--muted);
}
.card .text {
  position:absolute; left:14px; right:14px; bottom:64px; top:calc(58% + 44px);
  background: rgba(255,255,255,.45);
  border-radius:8px; padding:10px 12px; font-size:13px; line-height:1.35; overflow:auto;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.08);
}
.stats {
  position:absolute; left:0; right:0; bottom:8px; display:flex; justify-content:space-between; padding:0 10px;
}
.stat {
  width:52px; height:52px; border-radius:50%; display:flex; align-items:center; justify-content:center;
  background: radial-gradient(circle at 30% 30%, #fff 0, #eee 40%, #d2c8a6 70%, #a99b6c 100%);
  border:3px solid #3b382e; font-weight:900; font-size:22px; color:#1f1d18;
  box-shadow: 0 2px 4px rgba(0,0,0,.35);
  position:relative;
}
.stat.atk::after, .stat.hp::after {
  content: attr(data-label); position:absolute; bottom:-18px; font-size:11px; font-weight:700; color: var(--muted);
  left:0; right:0; text-align:center;
}
.stat.atk { outline: 3px solid color-mix(in lab, var(--bad), #000 10%); outline-offset: -6px; }
.stat.hp { outline: 3px solid color-mix(in lab, var(--good), #000 10%); outline-offset: -6px; }
.badge {
  position:absolute; right:10px; bottom:8px; padding:4px 8px; font-size:11px; font-weight:800; color:#fff;
  background: linear-gradient(180deg, color-mix(in lab, var(--accent), #fff 20%), var(--accent));
  border-radius: 6px; box-shadow:0 2px 4px rgba(0,0,0,.25), inset 0 0 0 2px rgba(255,255,255,.15);
}
.controls {
  min-width:320px; flex:1 1 340px; background:#1d1f22; color:#d7dbe0; border-radius:12px; padding:16px; border:1px solid #2a2e33;
}
.controls h3 { margin:6px 0 10px; font-size:16px; color:#b8c1ca; }
.controls .row { display:grid; grid-template-columns: 110px 1fr; gap:10px; align-items:center; margin:6px 0; }
.controls input[type="text"], .controls input[type="number"], .controls textarea, .controls select {
  width:100%; padding:8px 10px; border-radius:8px; border:1px solid #39414a; background:#0f1113; color:#e8edf2;
}
.controls input[type="range"] { width:100%; }
.controls .cols { display:flex; gap:10px; }
.controls .cols > div { flex:1; }
.controls .btns { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
button { padding:10px 12px; border:none; border-radius:10px; background:#2d7ef0; color:#fff; font-weight:700; cursor:pointer; }
button.secondary { background:#3a4047; }
.tip { font-size:12px; color:#9aa4af; margin-top:6px; }
.small { font-size:12px; color:#aeb6bf; }
hr { border:none; height:1px; background:#2a2e33; margin:10px 0; }
.note { font-size:12px; color:#9aa4af; margin-top:8px;}
[contenteditable="true"]:focus { outline: 2px dashed var(--accent); outline-offset: 2px; background: rgba(255,255,255,.2); }
</style>
</head>
<body>
<div class="wrapper">
  <div class="preview">
    <div id="card" class="card" role="img" aria-label="卡牌预览">
      <div class="inner">
        <div id="cost" class="cost">3</div>
        <div id="rarity" class="rarity" title="稀有度">★★</div>
        <div id="art" class="art"><img id="artImg" alt="插画" src="" /></div>
        <div class="name-banner">
          <div id="flag" class="faction-flag" title="阵营"></div>
          <div id="name" class="name" contenteditable="true" spellcheck="false">勇敢的步兵</div>
        </div>
        <div id="type" class="type" contenteditable="true" spellcheck="false">步兵 · 普通</div>
        <div id="text" class="text" contenteditable="true" spellcheck="false">部署：从牌库抽一张牌。行动：+1攻击直到回合结束。</div>
        <div class="stats">
          <div id="atk" class="stat atk" data-label="攻击">2</div>
          <div id="hp" class="stat hp" data-label="耐久">3</div>
        </div>
        <div id="badge" class="badge">美国</div>
      </div>
    </div>
    <div class="note">提示：你也可以直接在卡面文字上双击编辑（名称/类型/描述）。</div>
  </div>

  <div class="controls">
    <h3>卡面参数</h3>
    <div class="row">
      <label>名称</label>
      <input id="i-name" type="text" value="勇敢的步兵" />
    </div>
    <div class="row">
      <label>类型</label>
      <input id="i-type" type="text" value="步兵 · 普通" />
    </div>
    <div class="row">
      <label>描述</label>
      <textarea id="i-text" rows="4">部署：从牌库抽一张牌。行动：+1攻击直到回合结束。</textarea>
    </div>
    <div class="cols">
      <div>
        <div class="row">
          <label>费用</label>
          <input id="i-cost" type="range" min="0" max="20" value="3" />
        </div>
        <div class="row">
          <label>攻击</label>
          <input id="i-atk" type="range" min="0" max="20" value="2" />
        </div>
      </div>
      <div>
        <div class="row">
          <label>稀有度</label>
          <input id="i-rarity" type="range" min="0" max="5" value="2" />
        </div>
        <div class="row">
          <label>耐久</label>
          <input id="i-hp" type="range" min="0" max="20" value="3" />
        </div>
      </div>
    </div>

    <hr />

    <h3>阵营与主题</h3>
    <div class="row">
      <label>阵营</label>
      <select id="i-faction">
        <option value="USA" selected>美国</option>
        <option value="UK">英国</option>
        <option value="Germany">德国</option>
        <option value="USSR">苏联</option>
        <option value="Japan">日本</option>
        <option value="Neutral">中立</option>
        <option value="Custom">自定义颜色</option>
      </select>
    </div>
    <div class="row" id="customColorRow" style="display:none">
      <label>主题色</label>
      <input id="i-color" type="color" value="#9b8c5c" />
    </div>
    <div class="row">
      <label>阵营徽标</label>
      <select id="i-flagStyle">
        <option value="circle" selected>圆形</option>
        <option value="square">方形</option>
        <option value="none">无</option>
      </select>
    </div>

    <hr />

    <h3>插画</h3>
    <div class="row">
      <label>上传图片</label>
      <input id="i-art" type="file" accept="image/*" />
    </div>
    <div class="btns">
      <button type="button" id="btn-clear" class="secondary">清除插画</button>
      <button type="button" id="btn-export">导出为PNG</button>
    </div>
    <div class="tip">导出时将只导出卡牌本体，分辨率自动放大，适合预览与文档。若需印刷级矢量或尺寸，请告诉我。</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const el = {
  name: document.getElementById('name'),
  type: document.getElementById('type'),
  text: document.getElementById('text'),
  cost: document.getElementById('cost'),
  atk: document.getElementById('atk'),
  hp: document.getElementById('hp'),
  rarity: document.getElementById('rarity'),
  flag: document.getElementById('flag'),
  badge: document.getElementById('badge'),
  card: document.getElementById('card'),
  artImg: document.getElementById('artImg')
};
const input = {
  name: document.getElementById('i-name'),
  type: document.getElementById('i-type'),
  text: document.getElementById('i-text'),
  cost: document.getElementById('i-cost'),
  atk: document.getElementById('i-atk'),
  hp: document.getElementById('i-hp'),
  rarity: document.getElementById('i-rarity'),
  faction: document.getElementById('i-faction'),
  color: document.getElementById('i-color'),
  flagStyle: document.getElementById('i-flagStyle'),
  art: document.getElementById('i-art'),
  customColorRow: document.getElementById('customColorRow'),
  clear: document.getElementById('btn-clear'),
  export: document.getElementById('btn-export'),
};

const factionThemes = {
  USA:   { name: '美国', color: '#1d5aa6', flag: 'linear-gradient(90deg, #b22234 0 45%, #fff 45% 55%, #b22234 55% 100%)', badge: '美国' },
  UK:    { name: '英国', color: '#95342a', flag: 'linear-gradient(90deg, #00247d 0 100%)', badge: '英国' },
  Germany:{ name: '德国', color: '#3a3a3a', flag: 'linear-gradient(180deg, #000 0 33%, #dd0000 33% 66%, #ffce00 66% 100%)', badge: '德国' },
  USSR:  { name: '苏联', color: '#b02020', flag: 'linear-gradient(90deg, #cc0000, #a80000)', badge: '苏联' },
  Japan: { name: '日本', color: '#b32525', flag: 'radial-gradient(circle at 50% 50%, #bc002d 0 50%, transparent 50% 100%)', badge: '日本' },
  Neutral:{ name: '中立', color: '#9b8c5c', flag: 'conic-gradient(from 0deg, #fff 0 25%, transparent 25% 50%, #d00 50% 75%, transparent 75% 100%)', badge:'中立' }
};

function setAccent(color) {
  document.documentElement.style.setProperty('--accent', color);
}

function setFaction(key) {
  if (key === 'Custom') {
    input.customColorRow.style.display = '';
    setAccent(input.color.value);
    el.badge.textContent = '自定义';
    el.flag.style.background = '#999';
  } else {
    input.customColorRow.style.display = 'none';
    const t = factionThemes[key] || factionThemes.Neutral;
    setAccent(t.color);
    el.badge.textContent = t.badge;
    el.flag.style.background = t.flag;
  }
}

function setFlagStyle(style) {
  if (style === 'none') {
    el.flag.style.display = 'none';
  } else {
    el.flag.style.display = 'block';
    el.flag.style.borderRadius = style === 'circle' ? '50%' : '6px';
  }
}

function updateRarity(n) {
  const stars = '★'.repeat(Number(n));
  el.rarity.textContent = stars;
  el.rarity.style.opacity = n > 0 ? 1 : .25;
}

function bind() {
  input.name.addEventListener('input', e => el.name.textContent = e.target.value);
  input.type.addEventListener('input', e => el.type.textContent = e.target.value);
  input.text.addEventListener('input', e => el.text.textContent = e.target.value);
  input.cost.addEventListener('input', e => el.cost.textContent = e.target.value);
  input.atk.addEventListener('input', e => el.atk.textContent = e.target.value);
  input.hp.addEventListener('input', e => el.hp.textContent = e.target.value);
  input.rarity.addEventListener('input', e => updateRarity(e.target.value));
  input.faction.addEventListener('change', e => setFaction(e.target.value));
  input.color.addEventListener('input', e => { if (input.faction.value === 'Custom') setAccent(e.target.value); });
  input.flagStyle.addEventListener('change', e => setFlagStyle(e.target.value));

  // 支持在卡面直接编辑，并同步回面板
  el.name.addEventListener('input', () => input.name.value = el.name.textContent);
  el.type.addEventListener('input', () => input.type.value = el.type.textContent);
  el.text.addEventListener('input', () => input.text.value = el.text.textContent);

  // 插画上传
  input.art.addEventListener('change', e => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => { el.artImg.src = reader.result; };
    reader.readAsDataURL(file);
  });
  input.clear.addEventListener('click', () => {
    el.artImg.removeAttribute('src');
    input.art.value = '';
  });

  // 导出PNG
  input.export.addEventListener('click', async () => {
    document.activeElement && document.activeElement.blur();
    const node = el.card;
    const canvas = await html2canvas(node, { backgroundColor: null, scale: 3, useCORS: true });
    const link = document.createElement('a');
    link.download = `${el.name.textContent || 'card'}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
}

function init() {
  setFaction(input.faction.value);
  setFlagStyle(input.flagStyle.value);
  updateRarity(input.rarity.value);
}
bind();
init();
</script>
</body>
</html>