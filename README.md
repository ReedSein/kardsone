# 3D 球体色块分组面积对比 Demo

一个基于 three.js 的纯前端 Demo，用于：

- 在 3D 球体上展示一张纹理图（手机/PC 可旋转缩放）
- 点击球体选取“附近连通色块区域”（按颜色 + 范围）
- 将多个选区分为 A 组 / B 组，计算并对比：
  - A 组总面积 (a + b + c + ...)
  - B 组总面积 (d + e + f + ...)

适用于产品配色、区域占比分析等场景，可直接部署到 GitHub Pages。

## 在线预览

启用 GitHub Pages 后访问：

https://reedsein.github.io/sphere-color-compare/

## 使用方式

1. 克隆或下载本仓库。
2. 确保 `assets/texture.png` 存在且为球面贴图（建议 2:1 比例）。
3. 直接用浏览器打开 `index.html` 即可本地预览。

## 页面操作说明

- 拖动：旋转球体
- 滚轮 / 双指缩放：缩放视图
- 点击球体：
  - 自动识别点击点附近的连通色块，计算为一个“选区”
  - 在下方列表中显示该选区的面积占比
- 列表按钮：
  - “加到A组”：将该选区加入 A 组
  - “加到B组”：将该选区加入 B 组
  - “移除”：删除该选区
- “计算 A 组 vs B 组”：
  - 显示两个分组的总面积占比及 A/B 比值

## 技术说明（简要）

- three.js + OrbitControls（通过 CDN 引入）
- Raycaster 获取点击点 UV 坐标
- 在纹理空间进行局部泛洪（颜色 + UV 距离限制）
- 通过等距矩形投影 + cos(lat) 加权估算球面面积占比

## 注意事项

- 此 Demo 假设纹理为等距矩形球面贴图，否则面积计算仅作近似参考。
- `colorTolerance`、`maxUvDistance`、`maxRegionPixels` 可在 `index.html` 中按需要调整。
- 纯静态项目，无需后端，可直接部署到 GitHub Pages。
--------------------------------

4) /docs/ContextLibrary_3dSphere_v2.0.md

这是我们约定的“项目上下文记录”，方便你以后迭代。

示例内容（你可以直接创建这个文件）：

--------------------------------
需求时间: 2025-11-12

用户需求:
- 将图片贴到 3D 球体上，手机端可旋转/缩放浏览，并部署到 GitHub Pages。
- 在球体上基于纹理选择色块区域，计算其在球体表面的面积占比。
- 支持多块区域分组求和对比，如 (a+b+c) vs (d+e+f)。
- 只统计“点击点附近的连通区域”，而非整张图中所有同色像素。

解决方案与实施步骤:
1. 使用 three.js + OrbitControls 创建可交互的 3D 球体场景。
2. 使用纹理贴图 (texture.png) 作为球体表面。
3. 在用户点击球体时，通过 Raycaster 获取交点 UV 坐标。
4. 在纹理空间以 UV 为中心进行局部泛洪:
   - 按颜色容差筛选相近像素
   - 按 UV 距离限制范围，确保只选取“附近色块”
   - 限制最大像素数量防止卡死
5. 使用等距矩形投影 + cos(lat) 加权，计算该选区对应球面面积占比。
6. 将每个选区作为 segment，允许加入 A 组或 B 组，最后分别求和并对比。

关键技术决策和原因:
- three.js:
  - 成熟稳定，适合快速实现 WebGL 场景，避免重复造轮子（KISS）。
- 纯静态部署:
  - 兼容 GitHub Pages，无需后端和构建工具，降低复杂度（YAGNI）。
- 局部泛洪而非全局颜色搜索:
  - 满足“只识别点击附近色块”的业务需求，同时控制性能和交互合理性。
- 基于 cos(lat) 的球面面积估算:
  - 与等距矩形贴图匹配，简单可靠，易于维护和解释。

遇到的问题及解决方法:
- 问题: 同色大区域可能被全部选中。
  - 解决: 增加 UV 距离限制 maxUvDistance 和像素数量上限 maxRegionPixels。
- 问题: 面积精度与纹理投影方式相关。
  - 解决: 在 README 中明确要求使用等距矩形球面贴图。

最终成果总结:
- 一个单文件 (index.html) 即可运行的 3D 球体色块选择和分组面积对比工具。
- 支持手机和 PC，易于通过 GitHub Pages 部署和分享。
- 结构清晰，便于未来扩展（高亮选区、多纹理、更多分组等）。
